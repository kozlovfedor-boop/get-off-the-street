<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Location Refactor Test</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .test { margin: 10px 0; padding: 10px; background: #f0f0f0; }
        .pass { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
        h2 { margin-top: 30px; }
    </style>
</head>
<body>
    <h1>Location Refactor Test Suite</h1>
    <div id="results"></div>

    <!-- Load all location class files -->
    <script src="js/config.js"></script>
    <script src="js/locations/base-location.js"></script>
    <script src="js/locations/shelter-location.js"></script>
    <script src="js/locations/park-location.js"></script>
    <script src="js/locations/camden-town-location.js"></script>
    <script src="js/locations/london-city-location.js"></script>
    <script src="js/locations/location-factory.js"></script>
    <script src="js/time.js"></script>
    <script src="js/location-service.js"></script>

    <script>
        const results = document.getElementById('results');
        let testCount = 0;
        let passCount = 0;

        function test(name, fn) {
            testCount++;
            try {
                const result = fn();
                if (result) {
                    passCount++;
                    results.innerHTML += `<div class="test pass">✓ ${name}</div>`;
                } else {
                    results.innerHTML += `<div class="test fail">✗ ${name} - Assertion failed</div>`;
                }
            } catch (e) {
                results.innerHTML += `<div class="test fail">✗ ${name} - Error: ${e.message}</div>`;
            }
        }

        // Test 1: Location Factory
        results.innerHTML += '<h2>Location Factory Tests</h2>';
        test('Create shelter location', () => {
            const shelter = createLocation('shelter');
            return shelter.id === 'shelter' && shelter.name === 'Homeless Shelter';
        });

        test('Create park location', () => {
            const park = createLocation('park');
            return park.id === 'park' && park.name === 'City Park';
        });

        test('Create camden town location', () => {
            const camden = createLocation('camden-town');
            return camden.id === 'camden-town' && camden.name === 'Camden Town';
        });

        test('Create london city location', () => {
            const london = createLocation('london-city');
            return london.id === 'london-city' && london.name === 'London City';
        });

        // Test 2: Location Actions
        results.innerHTML += '<h2>Location Actions Tests</h2>';
        test('Shelter has sleep and eat actions', () => {
            const shelter = createLocation('shelter');
            const actions = shelter.getActions();
            return actions.includes('sleep') && actions.includes('eat') && actions.length === 2;
        });

        test('Park has sleep, panhandle, food actions', () => {
            const park = createLocation('park');
            const actions = park.getActions();
            return actions.includes('sleep') && actions.includes('panhandle') && actions.includes('food');
        });

        test('Camden Town has work, panhandle, steal, sleep actions', () => {
            const camden = createLocation('camden-town');
            const actions = camden.getActions();
            return actions.includes('work') && actions.includes('sleep') && actions.includes('steal');
        });

        test('London City does NOT have sleep action', () => {
            const london = createLocation('london-city');
            const actions = london.getActions();
            return !actions.includes('sleep') && actions.includes('work');
        });

        // Test 3: Sleep Previews
        results.innerHTML += '<h2>Sleep Preview Tests</h2>';
        test('Shelter sleep: 7h duration', () => {
            const shelter = createLocation('shelter');
            const preview = shelter.getSleepPreview();
            return preview.timeCost === 7;
        });

        test('Park sleep: 3h duration', () => {
            const park = createLocation('park');
            const preview = park.getSleepPreview();
            return preview.timeCost === 3;
        });

        test('Camden sleep: 2h duration', () => {
            const camden = createLocation('camden-town');
            const preview = camden.getSleepPreview();
            return preview.timeCost === 2;
        });

        test('London City sleep: not available', () => {
            const london = createLocation('london-city');
            const preview = london.getSleepPreview();
            return preview === null;
        });

        // Test 4: Pay Modifiers
        results.innerHTML += '<h2>Pay Modifier Tests</h2>';
        test('London City: 1.5x pay modifier', () => {
            const london = createLocation('london-city');
            return london.getPayModifier() === 1.5;
        });

        test('Camden Town: 1.0x pay modifier', () => {
            const camden = createLocation('camden-town');
            return camden.getPayModifier() === 1.0;
        });

        test('Park: default 1.0x pay modifier', () => {
            const park = createLocation('park');
            return park.getPayModifier() === 1.0;
        });

        // Test 5: Work Previews
        results.innerHTML += '<h2>Work Preview Tests</h2>';
        test('Camden Town work preview: £20-40', () => {
            const camden = createLocation('camden-town');
            const preview = camden.getWorkPreview();
            return preview.earnings[0] === 20 && preview.earnings[1] === 40;
        });

        test('London City work preview: £30-60', () => {
            const london = createLocation('london-city');
            const preview = london.getWorkPreview();
            return preview.earnings[0] === 30 && preview.earnings[1] === 60;
        });

        // Test 6: LocationService
        results.innerHTML += '<h2>LocationService Tests</h2>';
        test('LocationService creates location instances', () => {
            const timeManager = new TimeManager(6);
            const locationService = new LocationService(timeManager);
            const park = locationService.getCurrentLocation();
            return park.id === 'park' && typeof park.getActions === 'function';
        });

        test('LocationService delegates isActionAvailable', () => {
            const timeManager = new TimeManager(12); // Noon
            const locationService = new LocationService(timeManager);
            locationService.currentLocation = 'shelter';
            const result = locationService.isActionAvailable('sleep');
            return result.available === false; // Shelter closed at noon
        });

        test('LocationService delegates getRiskModifier', () => {
            const timeManager = new TimeManager(23); // 11pm (nighttime)
            const locationService = new LocationService(timeManager);
            locationService.currentLocation = 'park';
            const risk = locationService.getRiskModifier('sleep');
            return risk === 0.25; // 25% night robbery at park
        });

        test('LocationService delegates getPayModifier', () => {
            const timeManager = new TimeManager(12);
            const locationService = new LocationService(timeManager);
            locationService.currentLocation = 'london-city';
            const pay = locationService.getPayModifier();
            return pay === 1.5;
        });

        // Test 7: Travel Times
        results.innerHTML += '<h2>Travel Time Tests</h2>';
        test('Shelter to Park: 0.5 hours', () => {
            const shelter = createLocation('shelter');
            const travelTime = shelter.getTravelTime();
            return travelTime['park'] === 0.5;
        });

        test('Camden to London: 0.5 hours', () => {
            const camden = createLocation('camden-town');
            const travelTime = camden.getTravelTime();
            return travelTime['london-city'] === 0.5;
        });

        // Summary
        results.innerHTML += `<h2>Test Summary</h2>`;
        results.innerHTML += `<div class="test ${passCount === testCount ? 'pass' : 'fail'}">`;
        results.innerHTML += `Passed: ${passCount}/${testCount}`;
        results.innerHTML += `</div>`;
    </script>
</body>
</html>
